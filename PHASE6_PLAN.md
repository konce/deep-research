# Phase 6 å¼€å‘è®¡åˆ’ï¼šæŠ¥å‘Šç”Ÿæˆå¢å¼º

**å¼€å§‹æ—¶é—´**: 2026-01-20
**é¢„è®¡å®Œæˆ**: ç¬¬ 6-7 å¤©
**å‰ç½®æ¡ä»¶**: Phase 5 å®Œæˆ âœ…

---

## ğŸ¯ Phase 6 ç›®æ ‡

å¢å¼ºæŠ¥å‘Šç”Ÿæˆç³»ç»Ÿï¼Œæä¾›æ›´å¥½çš„æ ¼å¼åŒ–ã€æ¨¡æ¿åŒ–å’Œå¯æ‰©å±•æ€§ã€‚

---

## ğŸ“‹ å½“å‰çŠ¶æ€åˆ†æ

### âœ… å·²æœ‰åŠŸèƒ½
1. **reportWriter MCP å·¥å…·** (`tools/reportWriter.ts`)
   - åŸºç¡€ Markdown ç”Ÿæˆ
   - æ”¯æŒ sections å’Œ subsections
   - å¼•ç”¨åˆ—è¡¨ç”Ÿæˆ
   - ç»Ÿè®¡ä¿¡æ¯ï¼ˆå­—æ•°ã€æ®µè½æ•°ï¼‰

2. **æ•°æ®åº“å­˜å‚¨** (`AgentService.ts`)
   - æŠ¥å‘Šä¿å­˜åˆ° Report è¡¨
   - å…ƒæ•°æ®å­˜å‚¨

3. **Prisma Schema**
   - Report æ¨¡å‹å·²å®šä¹‰
   - ä¸ ResearchSession å…³è”

### âš ï¸ å¾…æ”¹è¿›
1. æŠ¥å‘Šæ ¼å¼è¾ƒä¸ºåŸºç¡€
2. ç¼ºå°‘æŠ¥å‘Šæ¨¡æ¿ç³»ç»Ÿ
3. ç¼ºå°‘é«˜çº§ Markdown æ ¼å¼ï¼ˆè¡¨æ ¼ã€å¼•ç”¨å—ã€ä»£ç å—ï¼‰
4. ç¼ºå°‘å†…è”å¼•ç”¨æ”¯æŒ
5. ç¼ºå°‘æŠ¥å‘Šå¯¼å‡º API

---

## ğŸ—ï¸ Phase 6 ä»»åŠ¡

### 6.1 åˆ›å»º MarkdownGenerator æœåŠ¡ â­

**ç›®æ ‡**: åˆ›å»ºç‹¬ç«‹çš„ Markdown ç”ŸæˆæœåŠ¡ï¼Œæä¾›æ›´å¤šæ ¼å¼åŒ–é€‰é¡¹

**ä»»åŠ¡**:
- [ ] åˆ›å»º `apps/api/src/services/report/MarkdownGenerator.ts`
- [ ] å®ç°é«˜çº§ Markdown æ ¼å¼åŒ–
  - [ ] è¡¨æ ¼ç”Ÿæˆ
  - [ ] å¼•ç”¨å— (blockquote)
  - [ ] ä»£ç å— (code blocks)
  - [ ] åˆ—è¡¨ï¼ˆæœ‰åº/æ— åºï¼‰
  - [ ] å†…è”å¼•ç”¨ [1]
- [ ] å®ç° TOCï¼ˆç›®å½•ï¼‰ç”Ÿæˆ
- [ ] æ·»åŠ å‰è¨€/å…ƒæ•°æ®éƒ¨åˆ†
- [ ] å•å…ƒæµ‹è¯•

**æ–‡ä»¶**:
- `apps/api/src/services/report/MarkdownGenerator.ts`

### 6.2 æŠ¥å‘Šæ¨¡æ¿ç³»ç»Ÿ â­

**ç›®æ ‡**: æ”¯æŒä¸åŒç±»å‹çš„ç ”ç©¶ä½¿ç”¨ä¸åŒçš„æŠ¥å‘Šæ¨¡æ¿

**ä»»åŠ¡**:
- [ ] åˆ›å»º `apps/api/src/services/report/ReportTemplates.ts`
- [ ] å®šä¹‰æ¨¡æ¿æ¥å£
- [ ] å®ç°é»˜è®¤æ¨¡æ¿ï¼ˆå½“å‰æ ¼å¼ï¼‰
- [ ] å®ç°å­¦æœ¯æ¨¡æ¿ï¼ˆæ›´æ­£å¼ï¼‰
- [ ] å®ç°æŠ€æœ¯æ–‡æ¡£æ¨¡æ¿
- [ ] å®ç°ç®€æŠ¥æ¨¡æ¿ï¼ˆexecutive summary focusedï¼‰

**æ–‡ä»¶**:
- `apps/api/src/services/report/ReportTemplates.ts`
- `apps/api/src/services/report/types.ts`

### 6.3 å¢å¼º reportWriter å·¥å…·

**ç›®æ ‡**: é›†æˆæ–°çš„ MarkdownGenerator å’Œæ¨¡æ¿ç³»ç»Ÿ

**ä»»åŠ¡**:
- [ ] é‡æ„ reportWriter.ts ä½¿ç”¨ MarkdownGenerator
- [ ] æ·»åŠ æ¨¡æ¿é€‰æ‹©å‚æ•°ï¼ˆå¯é€‰ï¼‰
- [ ] æ”¯æŒé«˜çº§æ ¼å¼åŒ–é€‰é¡¹
- [ ] æ”¹è¿›é”™è¯¯å¤„ç†

**æ–‡ä»¶**:
- `apps/api/src/services/agent/tools/reportWriter.ts`

### 6.4 æŠ¥å‘Š API å¢å¼º

**ç›®æ ‡**: æä¾›æ›´å¥½çš„æŠ¥å‘Šç®¡ç† API

**ä»»åŠ¡**:
- [ ] å¢å¼º GET /api/reports/:id
  - [ ] è¿”å›å®Œæ•´æŠ¥å‘Šå†…å®¹
  - [ ] è¿”å›å…ƒæ•°æ®
  - [ ] æ”¯æŒæ ¼å¼å‚æ•°ï¼ˆmarkdown/htmlï¼‰
- [ ] å®ç° GET /api/reports/:id/download
  - [ ] ä¸‹è½½ä¸º .md æ–‡ä»¶
  - [ ] è®¾ç½®æ­£ç¡®çš„ Content-Type
- [ ] æ·»åŠ æŠ¥å‘Šç»Ÿè®¡ç«¯ç‚¹
  - [ ] GET /api/reports/:id/stats

**æ–‡ä»¶**:
- `apps/api/src/routes/reports.ts`

### 6.5 æŠ¥å‘Šè´¨é‡æ”¹è¿›

**ç›®æ ‡**: æ”¹è¿›ç”ŸæˆæŠ¥å‘Šçš„è´¨é‡å’Œå¯è¯»æ€§

**ä»»åŠ¡**:
- [ ] æ·»åŠ æŠ¥å‘ŠéªŒè¯
  - [ ] æ£€æŸ¥å¿…éœ€å­—æ®µ
  - [ ] éªŒè¯å¼•ç”¨æ ¼å¼
  - [ ] æ£€æŸ¥å†…å®¹é•¿åº¦
- [ ] æ”¹è¿›å¼•ç”¨æ ¼å¼
  - [ ] å†…è”å¼•ç”¨ï¼š`[1]`
  - [ ] å¼•ç”¨é“¾æ¥
  - [ ] APA/MLA æ ¼å¼é€‰é¡¹
- [ ] æ·»åŠ æŠ¥å‘Šé¢„è§ˆåŠŸèƒ½

**æ–‡ä»¶**:
- `apps/api/src/services/report/ReportValidator.ts`
- `apps/api/src/services/report/CitationFormatter.ts`

### 6.6 æµ‹è¯•å’Œæ–‡æ¡£

**ä»»åŠ¡**:
- [ ] åˆ›å»ºæŠ¥å‘Šç”Ÿæˆæµ‹è¯•
- [ ] æµ‹è¯•ä¸åŒæ¨¡æ¿
- [ ] æµ‹è¯•é«˜çº§æ ¼å¼åŒ–
- [ ] ç¼–å†™ Phase 6 æ–‡æ¡£
- [ ] æ›´æ–° API æ–‡æ¡£

**æ–‡ä»¶**:
- `test-report-generation.ts`
- `docs/PHASE6_COMPLETE.md`

---

## ğŸ¨ æ–°æ¶æ„è®¾è®¡

```
Report Generation Flow:

Agent (reportWriter tool)
    â†“
ReportTemplates.select(type)
    â†“
MarkdownGenerator.generate(template, data)
    â†“
ReportValidator.validate(report)
    â†“
Database (Prisma)
    â†“
API Routes (/api/reports)
```

### æ–°ç»„ä»¶

1. **MarkdownGenerator**
   - é«˜çº§æ ¼å¼åŒ–
   - æ¨¡å—åŒ–ç”Ÿæˆå™¨
   - å¯æ‰©å±•

2. **ReportTemplates**
   - æ¨¡æ¿å®šä¹‰
   - æ¨¡æ¿é€‰æ‹©
   - è‡ªå®šä¹‰æ¨¡æ¿æ”¯æŒ

3. **ReportValidator**
   - ç»“æ„éªŒè¯
   - å†…å®¹è´¨é‡æ£€æŸ¥
   - å¼•ç”¨å®Œæ•´æ€§

4. **CitationFormatter**
   - å¤šç§å¼•ç”¨æ ¼å¼
   - å†…è”å¼•ç”¨
   - å¼•ç”¨é“¾æ¥

---

## ğŸ“Š ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»å®Œæˆï¼‰
1. âœ… MarkdownGenerator æœåŠ¡
2. âœ… å¢å¼º reportWriter å·¥å…·
3. âœ… æŠ¥å‘Š API å¢å¼º

### ä¸­ä¼˜å…ˆçº§ï¼ˆå»ºè®®å®Œæˆï¼‰
1. ReportTemplates ç³»ç»Ÿ
2. æŠ¥å‘ŠéªŒè¯
3. å¼•ç”¨æ ¼å¼æ”¹è¿›

### ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰ï¼‰
1. HTML å¯¼å‡º
2. PDF å¯¼å‡ºï¼ˆæœªæ¥ï¼‰
3. è‡ªå®šä¹‰æ¨¡æ¿ä¸Šä¼ 

---

## ğŸš€ å®æ–½æ­¥éª¤

### Step 1: åˆ›å»ºæ ¸å¿ƒæœåŠ¡ï¼ˆ2-3å°æ—¶ï¼‰
1. MarkdownGenerator.ts
2. ReportTemplates.ts
3. ç±»å‹å®šä¹‰

### Step 2: é›†æˆåˆ° reportWriterï¼ˆ1å°æ—¶ï¼‰
1. é‡æ„ reportWriter.ts
2. æµ‹è¯•é›†æˆ

### Step 3: å¢å¼º APIï¼ˆ1-2å°æ—¶ï¼‰
1. æ›´æ–° reports.ts è·¯ç”±
2. æ·»åŠ ä¸‹è½½ç«¯ç‚¹
3. æµ‹è¯• API

### Step 4: æµ‹è¯•å’Œæ–‡æ¡£ï¼ˆ1-2å°æ—¶ï¼‰
1. ç«¯åˆ°ç«¯æµ‹è¯•
2. æ–‡æ¡£ç¼–å†™
3. ç¤ºä¾‹ç”Ÿæˆ

---

## âœ… å®Œæˆæ ‡å‡†

- [ ] MarkdownGenerator å®ç°å¹¶æµ‹è¯•
- [ ] è‡³å°‘2ä¸ªæŠ¥å‘Šæ¨¡æ¿å¯ç”¨
- [ ] reportWriter å·¥å…·ä½¿ç”¨æ–°ç³»ç»Ÿ
- [ ] æŠ¥å‘Š API å®Œæ•´å¯ç”¨
- [ ] æ‰€æœ‰ TypeScript æ£€æŸ¥é€šè¿‡
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡
- [ ] æ–‡æ¡£å®Œæˆ

---

## ğŸ“š å‚è€ƒ

- Markdown è§„èŒƒ: https://commonmark.org/
- APA å¼•ç”¨æ ¼å¼: https://apastyle.apa.org/
- å½“å‰å®ç°: `apps/api/src/services/agent/tools/reportWriter.ts`

---

*Phase 6 è®¡åˆ’ - å‡†å¤‡å¼€å§‹å®æ–½*
